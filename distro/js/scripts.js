function smcNumberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}class CInterestClass{constructor(e,t,a){this.settings={chart:{principle_colour:t,interest_colour:a}},this.mode="",this.fields={date:{clickListener:"#smc-date",fields:[".smc-date-control",".smc-date-result"]},fixed:{clickListener:"#smc-fixed",fields:[".smc-fixed-control",".smc-fixed-result"]}},this.chart_canvas="myChart",this.cal_results={contributions:"",compounded_returns:"",fixed_investment_value:"",date_interval_amount:"",date_interval:"",date_goal:"",date_date:""},this.chart_data="",this.changeMode(e);this.chart=new Chart(document.getElementById(this.chart_canvas).getContext("2d"),{type:"line",data:this.getChartData(),options:{legend:{display:!1},tooltips:{mode:"index",intersect:!1,callbacks:{label:function(e,t){return t.datasets[e.datasetIndex].label+": $"+e.yLabel}}},responsive:!0,scales:{xAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Year"}}],yAxes:[{stacked:!0,ticks:{callback:function(e){return"$"+e}},scaleLabel:{display:!0,labelString:"Balance"}}]}}}),document.querySelector("#investment_timespan").addEventListener("change",function(){document.querySelector("#investment_timespan_text").innerHTML=this.value+" years"})}changeMode(e){"fixed"===e||"date"===e?(this.mode=e,this.setMode(e)):console.error("Interest system mode must be either 'fixed' or 'date'")}setMode(e){"fixed"===e||"date"===e?"fixed"===e?(document.querySelector(this.fields.fixed.clickListener).classList.add("smc-active"),document.querySelector(this.fields.date.clickListener).classList.remove("smc-active"),this.fields.fixed.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.remove("smc-hidden")})}),this.fields.date.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.add("smc-hidden")})})):"date"===e?(document.querySelector(this.fields.date.clickListener).classList.add("smc-active"),document.querySelector(this.fields.fixed.clickListener).classList.remove("smc-active"),this.fields.date.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.remove("smc-hidden")})}),this.fields.fixed.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.add("smc-hidden")})})):console.error("Interest System - Invalid Mode"):console.error("Interest system mode must be either 'fixed' or 'date'")}updateValue(e,t){var a=parseFloat(e.getAttribute("min")),s=parseFloat(e.getAttribute("max")),r=parseFloat(e.getAttribute("step"))||1,n=e.dataset.value||e.defaultValue||0,c=parseFloat(e.value.replace(/\$/,"")),c=isNaN(parseFloat(c))?n:("add"==t?c+=r:"sub"==t&&(c-=r),c<a?a:s<c?s:c);e.dataset.value=c,e.value=(e.dataset.prepend||"")+c+(e.dataset.append||""),this.updateChart()}getChartData(){var e=parseFloat(document.getElementById("initial_deposit").dataset.value),t=parseFloat(document.querySelector("#estimated_return").dataset.value/100),a=parseFloat(document.querySelector("#contribution_amount").dataset.value),l=parseInt(document.querySelector("#investment_timespan").value),u=(new Date).getFullYear(),m=parseInt(document.querySelector("#compound_frequency").value),h=parseInt(document.querySelector("#contribution_frequency").value),s=0,r=0,f=(document.querySelector("#contribution_amount"),document.querySelector("#investment_goal"),document.querySelector("#investment_timespan"),document.querySelector("#investment_timespan_text"),document.querySelector("#estimated_return"),document.querySelector("#future_balance")),p=(document.querySelector("#contribution_frequency"),document.querySelector("#compound_frequency"),document.querySelector("#cinterest_result_contributions")),y=document.querySelector("#cinterest_result_compounded_return"),v=document.querySelector("#cinterest_result_value");if("fixed"===this.mode){for(var _=[],n=u;n<u+l;n++)_.push(n);for(var b={label:"Total Principal",backgroundColor:"rgb(0, 123, 255)",data:[]},q={label:"Total Interest",backgroundColor:"#1AAF5D",data:[]},c=1;c<=l;c++){var g,o,i=e+a*h*c,d=0,S=i;t&&(d=((g=e*(o=Math.pow(1+t/m,m*c)))+(o=a*(o-1)/(t/h))-i).toFixed(0),S=(g+o).toFixed(0)),f.innerHTML="$"+smcNumberWithCommas(S),b.data.push(i),q.data.push(d),s=i,r=d}return p.innerHTML="$"+smcNumberWithCommas(s),y.innerHTML="$"+smcNumberWithCommas(r),v.innerHTML="$"+smcNumberWithCommas(parseFloat(s)+parseFloat(r)),{labels:_,datasets:[b,q]}}"date"==this.mode||console.error("System mode not defined")}updateChart(){try{var e=this.getChartData();this.chart.data.labels=e.labels,this.chart.data.datasets[0].data=e.datasets[0].data,this.chart.data.datasets[1].data=e.datasets[1].data,this.chart.update()}catch(e){console.error(e.message)}}registerListeners(e){try{for(var a=this,t=(e.forEach(e=>{document.querySelector(e).addEventListener("change",function(){a.updateValue(this)})}),document.querySelectorAll("[data-counter]")),s=0;s<t.length;s++)t[s].addEventListener("click",function(){var e=document.querySelector('[name="'+this.dataset.field+'"]'),t=this.dataset.counter;e&&a.updateValue(e,t)})}catch(e){console.error(e)}}}!function(){var t=new CInterestClass("fixed","rgb(0, 123, 255)","#1AAF5D");console.log("Interest Manager Initiated");for(const a in t.fields)document.querySelector(t.fields[a].clickListener).addEventListener("click",e=>{e.preventDefault(),t.changeMode(a)});t.registerListeners(["#initial_deposit","#contribution_amount","#investment_goal","#investment_timespan","#smc_target_date","#contribution_frequency","#compound_frequency"])}();
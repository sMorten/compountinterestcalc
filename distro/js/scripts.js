function smcNumberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function monthDiff(e,t){var a=12*(t.getFullYear()-e.getFullYear());return(a=(a-=e.getMonth())+t.getMonth())<=0?0:a}var monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];class SMWAlertHandler{constructor(){this.alertbox=document.querySelector("#smw-alert"),this.alerttext=document.querySelector("#smw-alert .alert-text"),this.fadeOut(this.alertbox)}setAlert(e,t,a=3500){var r;switch(console.log("settings alert"),this.alerttext.innerHTML=t,e){case"error":r="smw-error";case"success":r="smw-success";default:r="smw-default"}this.alertbox.classList.add(r),this.fadeIn(this.alertbox,"block"),setTimeout(()=>{this.fadeOut(this.alertbox),this.alertbox.classList.remove(r),this.alerttext.innerHTML=""},a)}fadeOut(t){t.style.opacity=1,function e(){(t.style.opacity-=.1)<0?t.style.display="none":requestAnimationFrame(e)}()}fadeIn(a,e){a.style.opacity=0,a.style.display=e||"block",function e(){var t=parseFloat(a.style.opacity);1<(t+=.1)||(a.style.opacity=t,requestAnimationFrame(e))}()}}class CInterestClass{constructor(e,t,a){this.alertHandler=new SMWAlertHandler,this.settings={chart:{principle_colour:t,interest_colour:a}},this.mode="",this.fields={date:{clickListener:"#smc-date",fields:[".smc-date-control",".smc-date-result"]},fixed:{clickListener:"#smc-fixed",fields:[".smc-fixed-control",".smc-fixed-result"]}},this.chart_canvas="myChart",this.cal_results={contributions:"",compounded_returns:"",fixed_investment_value:"",date_interval_amount:"",date_interval:"",date_goal:"",date_date:""},this.initialized=!1,this.chart_data="",this.changeMode(e);this.chart=new Chart(document.getElementById(this.chart_canvas).getContext("2d"),{type:"line",data:this.getChartData(),options:{legend:{display:!1},tooltips:{mode:"index",intersect:!1,callbacks:{label:function(e,t){return t.datasets[e.datasetIndex].label+": $"+e.yLabel}}},responsive:!0,scales:{xAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Year"}}],yAxes:[{stacked:!0,ticks:{callback:function(e){return"$"+e}},scaleLabel:{display:!0,labelString:"Balance"}}]}}}),document.querySelector("#investment_timespan").addEventListener("change",function(){document.querySelector("#investment_timespan_text").innerHTML=this.value+" years"})}dateDiff(e,t){var a=new Date,r=a.getFullYear(),a=a.getMonth()+1;if(12*t+e<12*r+a)return-1;var s=e<a?e+12-a:e-a;return s+=e<a?12*(t-r)-12:12*(t-r)}changeMode(e){"fixed"===e||"date"===e?(this.mode=e,this.setMode(e)):console.error("Interest system mode must be either 'fixed' or 'date'")}setMode(e){"fixed"===e||"date"===e?("fixed"===e?(document.querySelector(this.fields.fixed.clickListener).classList.add("smc-active"),document.querySelector(this.fields.date.clickListener).classList.remove("smc-active"),this.fields.fixed.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.remove("smc-hidden")})}),this.fields.date.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.add("smc-hidden")})})):"date"===e?(document.querySelector(this.fields.date.clickListener).classList.add("smc-active"),document.querySelector(this.fields.fixed.clickListener).classList.remove("smc-active"),this.fields.date.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.remove("smc-hidden")})}),this.fields.fixed.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.add("smc-hidden")})})):console.error("Interest System - Invalid Mode"),this.initialized?this.updateChart():this.initialized=!0):console.error("Interest system mode must be either 'fixed' or 'date'")}updateValue(e,t){var a=parseFloat(e.getAttribute("min")),r=parseFloat(e.getAttribute("max")),s=parseFloat(e.getAttribute("step"))||1,n=e.dataset.value||e.defaultValue||0,o=parseFloat(e.value.replace(/\$/,"")),o=isNaN(parseFloat(o))?n:("add"==t?o+=s:"sub"==t&&(o-=s),o<a?a:r<o?r:o);e.dataset.value=o,e.value=(e.dataset.prepend||"")+o+(e.dataset.append||""),this.updateChart()}getChartData(){var d=parseFloat(document.getElementById("initial_deposit").dataset.value),u=parseFloat(document.querySelector("#estimated_return").dataset.value/100),m=parseFloat(document.querySelector("#contribution_amount").dataset.value),h=parseInt(document.querySelector("#investment_timespan").value),y=((new Date).getFullYear(),(new Date).getMonth(),parseInt(document.querySelector("#compound_frequency").value)),e=parseInt(document.querySelector("#contribution_frequency").value),f=parseFloat(document.getElementById("investment_goal").dataset.value),t=0,a=0,r=0;if(e<y)return this.alertHandler.setAlert("error","The Compound Frequency cannot be bigger than the Contribution Frequency"),"error";document.querySelector("#contribution_amount"),document.querySelector("#investment_goal"),document.querySelector("#investment_timespan"),document.querySelector("#investment_timespan_text"),document.querySelector("#estimated_return");var p=document.querySelector("#future_balance"),g=(document.querySelector("#contribution_frequency"),document.querySelector("#compound_frequency"),document.querySelector("#cinterest_result_contributions")),v=document.querySelector("#cinterest_result_compounded_return"),_=document.querySelector("#cinterest_result_value");document.querySelector("#smc-date-interval-amount"),document.querySelector("#smc-date-interval"),document.querySelector("#smc-date-goal"),document.querySelector("#smc-date-date");if("fixed"===this.mode){for(var b=(I=(F=new Date).getMonth())+1,q=(c=F.getFullYear(),w=h+c,this.dateDiff(b,w)),s=Math.pow(1+u*y/12,y/e)-1,S=q/e,n=m,x=[],L={label:"Total Principal",backgroundColor:this.settings.chart.principle_colour,data:[]},M={label:"Total Interest",backgroundColor:this.settings.chart.interest_colour,data:[]},o=0;o<=q;o+=e)0==o?(l=monthNames[I]+" "+c,T=0,r=C=d):(H=((D=I+o+12*c)-D%12)/12,l=monthNames[D%12]+" "+H,r+=(C=n)+(T=(r+n)*s)),t+=C,a+=T,x.push(l),L.data.push(t.toFixed(0)),M.data.push(a.toFixed(0));p.innerHTML="$"+smcNumberWithCommas(r.toFixed(0)),g.innerHTML="$"+smcNumberWithCommas(t.toFixed(0)),v.innerHTML="$"+smcNumberWithCommas(a.toFixed(0)),_.innerHTML="$"+smcNumberWithCommas(r.toFixed(0)),document.querySelector("#smc-date-interval-amount").innerHTML="$"+n.toFixed(2);var i="monthly";switch(e){case 1:i="monthly";case 3:i="quarterly";case 6:i="semi-annually";case 12:i="annually";default:i="monthly"}return document.querySelector("#smc-date-interval").innerHTML=i,document.querySelector("#smc-date-goal").innerHTML="$"+smcNumberWithCommas(f),{labels:x,datasets:[L,M]}}if("date"==this.mode){for(var F,c,l,C,T,D,H,b=parseInt(document.querySelector("#smc_target_month").value),w=parseInt(document.querySelector("#smc_target_year").value),I=(F=new Date).getMonth(),q=(c=F.getFullYear(),this.dateDiff(b,w)),s=Math.pow(1+u*y/12,y/e)-1,S=q/e,n=(f-d*Math.pow(1+s,S))*(0<s?s/(Math.pow(1+s,S)-1):1/S)/(1+s),x=[],L={label:"Total Principal",backgroundColor:this.settings.chart.principle_colour,data:[]},M={label:"Total Interest",backgroundColor:this.settings.chart.interest_colour,data:[]},o=0;o<=q;o+=e)0==o?(l=monthNames[I]+" "+c,T=0,r=C=d):(H=((D=I+o+12*c)-D%12)/12,l=monthNames[D%12]+" "+H,r+=(C=n)+(T=(r+n)*s)),t+=C,a+=T,x.push(l),L.data.push(t.toFixed(0)),M.data.push(a.toFixed(0));p.innerHTML="$"+smcNumberWithCommas(r.toFixed(0)),g.innerHTML="$"+smcNumberWithCommas(t.toFixed(0)),v.innerHTML="$"+smcNumberWithCommas(a.toFixed(0)),_.innerHTML="$"+smcNumberWithCommas(parseFloat(t)+parseFloat(a)),document.querySelector("#smc-date-interval-amount").innerHTML="$"+n.toFixed(2);i="monthly";switch(e){case 1:i="monthly";case 3:i="quarterly";case 6:i="semi-annually";case 12:i="annually";default:i="monthly"}return document.querySelector("#smc-date-interval").innerHTML=i,document.querySelector("#smc-date-goal").innerHTML="$"+smcNumberWithCommas(f),document.querySelector("#smc-date-date").innerHTML=monthNames[b-1]+" "+w,{labels:x,datasets:[L,M]}}console.error("System mode not defined")}updateChart(){try{var e=this.getChartData();this.chart.data.labels=e.labels,this.chart.data.datasets[0].data=e.datasets[0].data,this.chart.data.datasets[1].data=e.datasets[1].data,this.chart.update()}catch(e){console.error(e.message)}}registerListeners(e){try{for(var a=this,t=(e.forEach(e=>{document.querySelector(e).addEventListener("change",function(){a.updateValue(this)})}),document.querySelectorAll("[data-counter]")),r=0;r<t.length;r++)t[r].addEventListener("click",function(){var e=document.querySelector('[name="'+this.dataset.field+'"]'),t=this.dataset.counter;e&&a.updateValue(e,t)})}catch(e){console.error(e)}}}!function(){var t=new CInterestClass("fixed","rgb(0, 123, 255)","#1AAF5D");console.log("Interest Manager Initiated");for(const n in t.fields)document.querySelector(t.fields[n].clickListener).addEventListener("click",e=>{e.preventDefault(),t.changeMode(n)});var e=new Date,a=e.getFullYear()+1,r=e.getMonth(),s=r+1;smcDay=e.getDate(),s=s.toString().length<2?"0"+s.toString():s,smcDay=smcDay.toString().length<2?"0"+smcDay.toString():smcDay,document.querySelector("#smc_target_month").value=r+1,document.querySelector("#smc_target_year").value=a,document.querySelector("#smc_target_year").min=a-1,t.registerListeners(["#initial_deposit","#contribution_amount","#investment_goal","#investment_timespan","#contribution_frequency","#compound_frequency","#smc_target_year","#smc_target_month"])}();
function smcNumberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function monthDiff(e,t){var a=12*(t.getFullYear()-e.getFullYear());return(a=(a-=e.getMonth())+t.getMonth())<=0?0:a}class CInterestClass{constructor(e,t,a){this.settings={chart:{principle_colour:t,interest_colour:a}},this.mode="",this.fields={date:{clickListener:"#smc-date",fields:[".smc-date-control",".smc-date-result"]},fixed:{clickListener:"#smc-fixed",fields:[".smc-fixed-control",".smc-fixed-result"]}},this.chart_canvas="myChart",this.cal_results={contributions:"",compounded_returns:"",fixed_investment_value:"",date_interval_amount:"",date_interval:"",date_goal:"",date_date:""},this.initialized=!1,this.chart_data="",this.changeMode(e);this.chart=new Chart(document.getElementById(this.chart_canvas).getContext("2d"),{type:"line",data:this.getChartData(),options:{legend:{display:!1},tooltips:{mode:"index",intersect:!1,callbacks:{label:function(e,t){return t.datasets[e.datasetIndex].label+": $"+e.yLabel}}},responsive:!0,scales:{xAxes:[{stacked:!0,scaleLabel:{display:!0,labelString:"Year"}}],yAxes:[{stacked:!0,ticks:{callback:function(e){return"$"+e}},scaleLabel:{display:!0,labelString:"Balance"}}]}}}),document.querySelector("#investment_timespan").addEventListener("change",function(){document.querySelector("#investment_timespan_text").innerHTML=this.value+" years"})}changeMode(e){"fixed"===e||"date"===e?(this.mode=e,this.setMode(e)):console.error("Interest system mode must be either 'fixed' or 'date'")}setMode(e){"fixed"===e||"date"===e?("fixed"===e?(document.querySelector(this.fields.fixed.clickListener).classList.add("smc-active"),document.querySelector(this.fields.date.clickListener).classList.remove("smc-active"),this.fields.fixed.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.remove("smc-hidden")})}),this.fields.date.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.add("smc-hidden")})})):"date"===e?(document.querySelector(this.fields.date.clickListener).classList.add("smc-active"),document.querySelector(this.fields.fixed.clickListener).classList.remove("smc-active"),this.fields.date.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.remove("smc-hidden")})}),this.fields.fixed.fields.forEach(e=>{document.querySelectorAll(e).forEach(e=>{e.classList.add("smc-hidden")})})):console.error("Interest System - Invalid Mode"),this.initialized?this.updateChart():this.initialized=!0):console.error("Interest system mode must be either 'fixed' or 'date'")}updateValue(e,t){var a=parseFloat(e.getAttribute("min")),r=parseFloat(e.getAttribute("max")),s=parseFloat(e.getAttribute("step"))||1,o=e.dataset.value||e.defaultValue||0,n=parseFloat(e.value.replace(/\$/,"")),n=isNaN(parseFloat(n))?o:("add"==t?n+=s:"sub"==t&&(n-=s),n<a?a:r<n?r:n);e.dataset.value=n,e.value=(e.dataset.prepend||"")+n+(e.dataset.append||""),this.updateChart()}getChartData(){var d=parseFloat(document.getElementById("initial_deposit").dataset.value),e=parseFloat(document.querySelector("#estimated_return").dataset.value/100),u=parseFloat(document.querySelector("#contribution_amount").dataset.value),m=parseInt(document.querySelector("#investment_timespan").value),h=(new Date).getFullYear(),t=parseInt(document.querySelector("#compound_frequency").value),y=parseInt(document.querySelector("#contribution_frequency").value),f=parseFloat(document.getElementById("investment_goal").dataset.value),a=0,r=0,p=y/t,g=(document.querySelector("#contribution_amount"),document.querySelector("#investment_goal"),document.querySelector("#investment_timespan"),document.querySelector("#investment_timespan_text"),document.querySelector("#estimated_return"),document.querySelector("#future_balance")),v=(document.querySelector("#contribution_frequency"),document.querySelector("#compound_frequency"),document.querySelector("#cinterest_result_contributions")),_=document.querySelector("#cinterest_result_compounded_return"),S=document.querySelector("#cinterest_result_value"),q=document.querySelector("#smc_target_date");document.querySelector("#smc-date-interval-amount"),document.querySelector("#smc-date-interval"),document.querySelector("#smc-date-goal"),document.querySelector("#smc-date-date");if("fixed"===this.mode){for(var s=[],o=h;o<h+m;o++)s.push(o);for(var b={label:"Total Principal",backgroundColor:this.settings.chart.principle_colour,data:[]},L={label:"Total Interest",backgroundColor:this.settings.chart.interest_colour,data:[]},n=1;n<=m;n++){var x,M,C=0,F=i=d+u*y*n;e&&(C=((x=d*(A=Math.pow(1+e/t,t*n)))+(M=u*(A-1)/(e/y))-i).toFixed(0),F=(x+M).toFixed(0)),g.innerHTML="$"+smcNumberWithCommas(F),b.data.push(i),L.data.push(C),a=i,r=C}return v.innerHTML="$"+smcNumberWithCommas(a),_.innerHTML="$"+smcNumberWithCommas(r),S.innerHTML="$"+smcNumberWithCommas(parseFloat(a)+parseFloat(r)),{labels:s,datasets:[b,L]}}if("date"==this.mode){for(var k=q.value.split("-"),D=k[2],T=k[1],E=k[0],k=new Date(E,T-1,D),I=new Date,w=Math.floor(y*((k-I)/3154e7))+1,s=[],o=h;o<=E;o++)if(o==I.getFullYear())for(var c=I.getMonth()+1;c<=12;c++)s.push(c+"/"+o);else if(o<E)for(c=1;c<=12;c++)s.push(c+"/"+o);else for(c=1;c<=T;c++)s.push(c+"/"+o);b={label:"Total Principal",backgroundColor:this.settings.chart.principle_colour,data:[]},L={label:"Total Interest",backgroundColor:this.settings.chart.interest_colour,data:[]};if(e){monthDiff(I,k);for(var H=e/t,$=H*(f-d*Math.pow(1+H,w*(1/p)))/(Math.pow(1+H,w*(1/p))-1)/p,F=(console.log(e+" : "+t+" : "+w),0),n=0;n<=w;n++){var i,A,N=(i=d+$*n)*(A=Math.pow(1+H,n*t)),W=$*(A-1)/H,C=((F=(N+W).toFixed(0))-i).toFixed(0);console.log(A),console.log(F+" : "+i+" : "+C),console.log("Test: "+W+" : "+N),console.log(H),b.data.push(i.toFixed(0)),L.data.push(C),a=i,r=C}g.innerHTML="$"+smcNumberWithCommas(F)}v.innerHTML="$"+smcNumberWithCommas(a.toFixed(0)),_.innerHTML="$"+smcNumberWithCommas(r),S.innerHTML="$"+smcNumberWithCommas(parseFloat(a)+parseFloat(r)),document.querySelector("#smc-date-interval-amount").innerHTML="$"+$.toFixed(2);var l="monthly";switch(y){case 52:l="weekly";case 26:l="bi-weekly";case 24:l="semi-monthly";case 12:l="monthly";case 4:l="quarterly";case 2:l="semi-annually";case 1:l="annually";default:l="monthly"}return document.querySelector("#smc-date-interval").innerHTML=l,document.querySelector("#smc-date-goal").innerHTML="$"+smcNumberWithCommas(f),document.querySelector("#smc-date-date").innerHTML=q.value,{labels:s,datasets:[b,L]}}console.error("System mode not defined")}updateChart(){try{var e=this.getChartData();this.chart.data.labels=e.labels,this.chart.data.datasets[0].data=e.datasets[0].data,this.chart.data.datasets[1].data=e.datasets[1].data,this.chart.update()}catch(e){console.error(e.message)}}registerListeners(e){try{for(var a=this,t=(e.forEach(e=>{document.querySelector(e).addEventListener("change",function(){a.updateValue(this)})}),document.querySelectorAll("[data-counter]")),r=0;r<t.length;r++)t[r].addEventListener("click",function(){var e=document.querySelector('[name="'+this.dataset.field+'"]'),t=this.dataset.counter;e&&a.updateValue(e,t)});document.querySelector("#smc_target_date").addEventListener("change",e=>{a.updateChart()})}catch(e){console.error(e)}}}!function(){var t=new CInterestClass("fixed","rgb(0, 123, 255)","#1AAF5D");console.log("Interest Manager Initiated");for(const s in t.fields)document.querySelector(t.fields[s].clickListener).addEventListener("click",e=>{e.preventDefault(),t.changeMode(s)});var e=new Date,a=e.getFullYear()+1,r=e.getMonth()+1;smcDay=e.getDate(),r=r.toString().length<2?"0"+r.toString():r,smcDay=smcDay.toString().length<2?"0"+smcDay.toString():smcDay,document.querySelector("#smc_target_date").value=a+"-"+r+"-"+smcDay,document.querySelector("#smc_target_year").value=a,document.querySelector("#smc_target_year").min=a-1,t.registerListeners(["#initial_deposit","#contribution_amount","#investment_goal","#investment_timespan","#contribution_frequency","#compound_frequency","#smc_target_year","#smc_target_month"])}();